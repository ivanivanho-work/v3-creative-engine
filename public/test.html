<!DOCTYPE html>
<html>
<head>
  <title>Job Status Check</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
    .job { background: #2a2a2a; padding: 15px; margin: 10px 0; border-radius: 5px; }
    .status { display: inline-block; padding: 3px 8px; border-radius: 3px; font-size: 12px; }
    .pending { background: #ffa500; color: #000; }
    .processing { background: #4169e1; }
    .complete { background: #32cd32; color: #000; }
    .error { background: #ff4444; }
    pre { background: #1a1a1a; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>üè≠ V3 Job Status Monitor</h1>
  <div id="jobs"></div>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBwtQBAZ_IewB2TYCkew3ctzB4HMs9Gyn0",
      authDomain: "v3-creative-engine.firebaseapp.com",
      projectId: "v3-creative-engine",
      storageBucket: "v3-creative-engine.firebasestorage.app",
      messagingSenderId: "964100659393",
      appId: "1:964100659393:web:bc6aa41fce9a8770d55c40"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const jobsDiv = document.getElementById('jobs');

    // Listen to jobs in real-time
    db.collection('jobs')
      .orderBy('createdAt', 'desc')
      .limit(10)
      .onSnapshot(snapshot => {
        jobsDiv.innerHTML = '';

        if (snapshot.empty) {
          jobsDiv.innerHTML = '<p>No jobs found</p>';
          return;
        }

        snapshot.forEach(doc => {
          const job = doc.data();
          const jobDiv = document.createElement('div');
          jobDiv.className = 'job';

          let resultHtml = '';
          if (job.result && job.result.metadata) {
            resultHtml = `<pre>${JSON.stringify(job.result.metadata, null, 2)}</pre>`;
          }

          let errorHtml = '';
          if (job.error) {
            errorHtml = `<p style="color: #ff4444;">Error: ${job.error}</p>`;
          }

          jobDiv.innerHTML = `
            <strong>Job ${doc.id}</strong>
            <span class="status ${job.status}">${job.status}</span>
            <p><strong>Type:</strong> ${job.type}</p>
            <p><strong>Prompt:</strong> ${job.prompt}</p>
            <p><strong>Format:</strong> ${job.format}</p>
            ${resultHtml}
            ${errorHtml}
          `;

          jobsDiv.appendChild(jobDiv);
        });
      });
  </script>
</body>
</html>
